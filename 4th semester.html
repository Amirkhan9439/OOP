<html>
<body>
<script src="resData.js"></script>
<script>
var body = document.getElementsByTagName("body")[0];
var par = document.createElement("p");
par.innerHTML = "This result was generated by a JS autofecher that fethed data from different pdfs, excels and text files collected from classroom. Any subsequent changes that were made after uploading of those result sheets <b>will not</b> reflected in the table bellow<br/>Click the corresponding column in the top most row to sort according to it<br/>The bottom-most row contains averages<br/>";
body.appendChild(par);
var labels = ["Reg No", "Name","OS Theory", "OS Lab", "DSA Thoery", "DSA Lab", "EC Thoery", "EC Lab","SS Thoery", "SS Lab", "PME", "CGPA"];
var letterGrades = ["A", "A-", "B+", "B", "B-", "C+", "C", "C-", "D+", "D", "F", "I"];
var digitGrades = [4, 3.67, 3.33, 3, 2.67, 2.33, 2, 1.67, 1.33, 1, 0, 0];
var avgs = [0,0,0,0,0,0,0,0,0,0];
exec();
function exec() {
	averages();
	//par.innerHTML = avgs;
	quickSort(result, 0, result.length - 1, 0);
	body.appendChild(drawTable(result, labels));
}
function drawTable(data, labels) {
	var table = document.createElement("Table");
	var th = document.createElement("tr");
	var nCols = labels.length;
	var nRows = data.length;
	for(var i = 0; i < nCols; i++) {
		var td = document.createElement("td");
		td.innerHTML = labels[i];
		td.addEventListener("click", function() {
			sort(this);
		});
		td.style.border = "2px solid black";
		td.style.padding = "5px";
		th.appendChild(td);
	}
	th.style.textAlign = "center";
	th.style.fontWeight = "bold";
	th.style.backgroundColor = "#ccc";
	table.appendChild(th);
	for(var rows = 0; rows < nRows;rows++) {
		var tr = document.createElement("tr");
		for(var cols = 0; cols < nCols; cols++) {
			var td = document.createElement("td");
			td.innerHTML = data[rows][cols];
			td.style.border = "2px solid black";
			td.style.padding = "5px";
			if(cols != 1) td.style.textAlign = "center";
			tr.appendChild(td);
		}
		table.appendChild(tr);
	}
	
	var tr = document.createElement("tr");
	for(var cols = -1; cols < avgs.length; cols++) {
		var td = document.createElement("td");
		if(cols == -1) {
			td.setAttribute("colspan", "2");
			td.innerHTML = "Average";
		}else
		td.innerHTML = avgs[cols];
		td.style.border = "2px solid black";
		td.style.padding = "10px";
		td.style.fontWeight = "bold";
		td.style.textAlign = "center";
		tr.appendChild(td);
	}
	table.appendChild(tr);	
	
	table.style.border = "1px solid black";
	table.style.borderCollapse = "collapse";
	return table;
}

function quickSort(arr, low, high, colRef, grades = false) {
	if(low < high) {
		var pi = partition(arr, low, high, colRef, grades);
		quickSort(arr, low, pi - 1, colRef, grades);
		quickSort(arr, pi + 1, high, colRef, grades);
	}
}

function partition(arr, low, high, colRef, grades) {
	var pivot = arr[high][colRef];
	var i = low - 1;
	for(var j = low; j < high; j++) {
		if((getGrade(arr[j][colRef], grades)) < (getGrade(pivot, grades))) {
			i++;
			var temp = arr[j];
			arr[j] = arr[i];
			arr[i] = temp;
		}
		}
	var temp = arr[i + 1];
	arr[i + 1] = arr[high];
	arr[high] = temp;
	return i + 1;
}

function getGrade(val, grades) {
	if(letterGrades.indexOf(val) != -1) 
		return digitGrades[letterGrades.indexOf(val)];
	return val;
}

function getGradeForAvg(val) {
	if(letterGrades.indexOf(val) != -1) 
		return digitGrades[letterGrades.indexOf(val)];
	return parseFloat(val);
}

function getCGPA(arr) {
	var credithour = 19;
	var GP = arr[0] * 3 + arr[1] * 1 + arr[2] * 3 + arr[3] * 1 + arr[4] * 3 + arr[5] * 1 + arr[6] * 3 + arr[7] * 1 + arr[8] * 3;
	var CGPA = GP / credithour;
	CGPA = (Math.round(CGPA*100))/100;
	return CGPA;
}

function sort(elem) {
	var val = labels.indexOf(elem.innerHTML);
	if(val > 1) 
		quickDeSort(result, 0, result.length - 1, val);
	else 
		quickSort(result, 0, result.length - 1, val);
	fill();
}
function fill() {
	var nrows = result.length;
	var ncols = result[0].length;
	for(var rows = 0; rows < nrows; rows++) {
		for(var cols = 0; cols < ncols; cols++) {
			document.getElementsByTagName("td")[(rows + 1) * ncols + cols].innerHTML = result[rows][cols];
		}
	}
}

function quickDeSort(arr, low, high, colRef) {
	if(low < high) {
		var pi = partitionDe(arr, low, high, colRef, true);
		quickDeSort(arr, low, pi - 1, colRef);
		quickDeSort(arr, pi + 1, high, colRef);
	}
}

function partitionDe(arr, low, high, colRef) {
	var pivot = arr[high][colRef];
	var i = low - 1;
	for(var j = low; j < high; j++) {
		if((getGrade(arr[j][colRef], true)) > (getGrade(pivot, true))) {
			i++;
			var temp = arr[j];
			arr[j] = arr[i];
			arr[i] = temp;
		}
		}
	var temp = arr[i + 1];
	arr[i + 1] = arr[high];
	arr[high] = temp;
	return i + 1;
}

function averages() {
	var nrows = result.length;
	var ncols = result[0].length;
	for(var rows = 0; rows < nrows; rows++) {
		for(var cols = 2; cols < ncols; cols++) {
			avgs[cols - 2] += getGradeForAvg(result[rows][cols]);
		}
	}
	for(var rows = 0; rows < avgs.length; rows++) 
	avgs[rows] = round((avgs[rows]/nrows));
}

function round(val) {
	return (Math.round(val * 100)/100);
}
</script>
</body>
</html>